<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èµ›åšç”µå­çƒŸèŠ± - V8</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.3/control_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/hands.js" crossorigin="anonymous"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      margin: 0;
      overflow: hidden;
      background-color: #050505;
      font-family: "Microsoft YaHei", sans-serif;
    }
    
    #input_video { display: none; }
    canvas { display: block; width: 100vw; height: 100vh; }
    
    /* å¯åŠ¨é®ç½© */
    #overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 200;
      flex-direction: column;
      backdrop-filter: blur(5px);
    }
    
    #overlay.hidden { display: none; }
    
    #start-btn {
      padding: 15px 50px;
      font-size: 22px;
      background: linear-gradient(45deg, #6c5ce7, #00cec9);
      border: none;
      color: white;
      border-radius: 40px;
      cursor: pointer;
      box-shadow: 0 0 30px rgba(108, 92, 231, 0.6);
      transition: transform 0.2s;
      font-family: "Microsoft YaHei";
    }
    
    #start-btn:hover { transform: scale(1.05); }
    
    #loading-text {
      color: #888;
      margin-top: 20px;
      font-size: 14px;
      letter-spacing: 1px;
    }
    
    /* æ§åˆ¶å° */
    #control-panel {
      position: absolute;
      top: 10px; right: 10px;
      width: 300px;
      max-height: 95vh;
      background: rgba(15, 15, 25, 0.95);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      overflow-y: auto;
      color: #fff;
      box-shadow: 0 0 30px rgba(0,0,0,0.6);
      z-index: 100;
      transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      scrollbar-width: thin;
      scrollbar-color: #555 #1a1a1a;
    }
    
    #control-panel.hidden { transform: translateX(320px); }
    
    #toggle-panel {
      position: absolute;
      top: 10px; right: 320px;
      width: 40px; height: 40px;
      background: rgba(15, 15, 25, 0.8);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: white;
      cursor: pointer;
      z-index: 101;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      transition: right 0.3s ease;
    }
    
    #toggle-panel.right { right: 10px; }
    
    h2 {
      margin: 0 0 15px 0;
      font-size: 20px;
      color: #a0a0ff;
      letter-spacing: 2px;
      text-align: center;
      font-weight: bold;
    }
    
    h3 {
      margin: 15px 0 10px 0;
      font-size: 14px;
      color: #888;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }
    
    /* å½¢çŠ¶æŒ‰é’® */
    .shape-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .shape-btn {
      background: #1a1a25;
      border: 1px solid #333;
      color: #aaa;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      text-align: center;
      transition: all 0.2s;
    }
    
    .shape-btn:hover { background: #333; }
    
    .shape-btn.active {
      background: #fff;
      color: #000;
      border-color: #fff;
      box-shadow: 0 0 15px rgba(255,255,255,0.4);
      font-weight: bold;
    }
    
    /* æ–‡æœ¬æ¡† */
    #text-input-container { margin-bottom: 15px; display: none; }
    
    textarea#firework-text {
      width: 100%;
      height: 80px;
      box-sizing: border-box;
      background: #111;
      border: 1px solid #444;
      color: #fff;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
      text-align: center;
      resize: vertical;
      font-family: "Microsoft YaHei", sans-serif;
      line-height: 1.5;
    }
    
    textarea#firework-text:focus { outline: none; border-color: #6c5ce7; }
    
    /* æ»‘å— */
    .control-group { margin-bottom: 12px; }
    
    .label-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-size: 13px;
      color: #ccc;
    }
    
    input[type=range] {
      -webkit-appearance: none;
      width: 100%;
      background: transparent;
      margin: 5px 0;
    }
    
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%;
      height: 6px;
      background: #333;
      border-radius: 3px;
    }
    
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 16px;
      width: 16px;
      border-radius: 50%;
      background: #6c5ce7;
      margin-top: -5px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(108, 92, 231, 0.8);
    }
    
    #hue-slider::-webkit-slider-runnable-track {
      background: linear-gradient(to right, red, yellow, lime, cyan, blue, magenta, red);
    }
    
    .hint {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,0.5);
      font-size: 14px;
      pointer-events: none;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    
    .gesture-hint {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(15, 15, 25, 0.8);
      padding: 10px 15px;
      border-radius: 8px;
      color: #aaa;
      font-size: 12px;
      z-index: 99;
      display: none;
    }
    
    .gesture-hint.visible { display: block; }
  </style>
</head>
<body>
  <video id="input_video" playsinline></video>
  <canvas id="canvas"></canvas>
  
  <div id="overlay">
    <button id="start-btn">å¯åŠ¨ èµ›åšçƒŸèŠ±ç³»ç»Ÿ</button>
    <div id="loading-text">è¯·å…è®¸æ‘„åƒå¤´æƒé™ â€¢ æåˆæ‰‹æŒ‡å‘å°„çƒŸèŠ±</div>
  </div>
  
  <button id="toggle-panel">âš™ï¸</button>
  
  <div id="control-panel">
    <h2>ğŸ† èµ›åšç”µå­çƒŸèŠ±</h2>
    
    <h3>çƒŸèŠ±å½¢çŠ¶</h3>
    <div class="shape-grid">
      <button class="shape-btn" data-shape="SPHERE">çƒå½¢</button>
      <button class="shape-btn" data-shape="RING">åœ†ç¯</button>
      <button class="shape-btn" data-shape="STAR">äº”è§’æ˜Ÿ</button>
      <button class="shape-btn" data-shape="HEART">çˆ±å¿ƒ</button>
      <button class="shape-btn active" data-shape="TEXT">æ–‡å­—(å®šåˆ¶)</button>
      <button class="shape-btn" data-shape="RANDOM">éšæœº</button>
    </div>
    
    <div id="text-input-container" style="display:block;">
      <textarea id="firework-text">é©¬åˆ°æˆåŠŸ
æ–°å¹´å¿«ä¹
æ­å–œå‘è´¢
ä¸‡äº‹å¦‚æ„</textarea>
      <div class="label-row" style="justify-content:center; margin-top:5px; color:#6c5ce7">æ”¯æŒå¤šè¡Œæ–‡æ¡ˆ â€¢ æ¯æ¬¡éšæœºæ’­æ”¾ â€¢ è‡ªåŠ¨ç¼©æ”¾</div>
    </div>
    
    <h3>ç‰©ç†å‚æ•°</h3>
    <div class="control-group">
      <div class="label-row"><span>ç²’å­æ•°é‡</span><span id="val-particles">300</span></div>
      <input type="range" id="p-particles" min="100" max="800" value="300">
    </div>
    
    <div class="control-group">
      <div class="label-row"><span>æ–‡å­—å¤§å°ç¼©æ”¾</span><span id="val-size">1.0</span></div>
      <input type="range" id="p-size" min="0.5" max="2.0" step="0.1" value="1.0">
      <div style="font-size:12px; color:#666">è°ƒèŠ‚æ–‡å­—çƒŸèŠ±ç‚¸å¼€çš„æ•´ä½“å°ºå¯¸</div>
    </div>
    
    <div class="control-group">
      <div class="label-row"><span>é‡åŠ›ç³»æ•°</span><span id="val-gravity">0.12</span></div>
      <input type="range" id="p-gravity" min="0" max="30" value="12">
    </div>
    
    <h3>è§†è§‰æ•ˆæœ</h3>
    <div class="control-group">
      <div class="label-row"><span>æ‹–å°¾é•¿åº¦</span><span id="val-trail">0.15</span></div>
      <input type="range" id="p-trail" min="5" max="50" value="15">
    </div>
    
    <div class="control-group">
      <div class="label-row"><span>é¢œè‰²åŸºè°ƒ</span><span id="val-hue">å½©è‰²/éšæœº</span></div>
      <input type="range" id="hue-slider" min="-1" max="360" value="-1">
    </div>
    
    <div class="control-group">
      <div class="label-row"><span>äº®åº¦</span><span id="val-brightness">1.0</span></div>
      <input type="range" id="p-brightness" min="0.2" max="2" step="0.1" value="1.0">
    </div>
  </div>
  
  <div class="hint">ğŸ‘† ç‚¹å‡»å±å¹•å‘å°„çƒŸèŠ±</div>
  <div class="gesture-hint">âœŒï¸ åŒæŒ‡æåˆå‘å°„çƒŸèŠ±</div>

  <script>
    // --- 1. é…ç½®å‚æ•° ---
    const PARAMS = {
      shape: 'TEXT',
      textRaw: "é©¬åˆ°æˆåŠŸ\næ–°å¹´å¿«ä¹\næ­å–œå‘è´¢\nä¸‡äº‹å¦‚æ„",
      particleCount: 300,
      sizeScale: 1.0,
      speed: 12,
      gravity: 0.12,
      friction: 0.96,
      trail: 0.15,
      hue: -1,
      variance: 40,
      brightness: 1.0
    };
    
    // --- 2. ç”»å¸ƒåˆå§‹åŒ– ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const textCanvas = document.createElement('canvas');
    const textCtx = textCanvas.getContext('2d');
    
    let width, height;
    let particles = [];
    let rockets = [];
    let isRunning = false;
    let lastPinchTime = 0;
    let camera = null;
    let hands = null;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
      textCanvas.width = width;
      textCanvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // --- 3. ç²’å­ç±» ---
    class Particle {
      constructor(x, y, vx, vy, color) {
        this.x = x;
        this.y = y;
        this.vx = vx;
        this.vy = vy;
        this.color = color;
        this.alpha = 1;
        this.decay = Math.random() * 0.015 + 0.005;
      }
      
      update() {
        this.vx *= PARAMS.friction;
        this.vy *= PARAMS.friction;
        this.vy += PARAMS.gravity;
        this.x += this.vx;
        this.y += this.vy;
        this.alpha -= this.decay;
      }
      
      draw(ctx) {
        ctx.save();
        ctx.globalAlpha = this.alpha * PARAMS.brightness;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }
      
      isDead() {
        return this.alpha <= 0;
      }
    }
    
    // ç«ç®­ç±»
    class Rocket {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = -PARAMS.speed - Math.random() * 4;
        this.exploded = false;
        this.trail = [];
      }
      
      update() {
        if (!this.exploded) {
          this.y += this.vy;
          this.vy += 0.15;
          
          this.trail.push({x: this.x, y: this.y, alpha: 1});
          this.trail = this.trail.filter(t => {
            t.alpha -= 0.05;
            return t.alpha > 0;
          });
          
          if (this.vy >= 0) {
            this.explode();
          }
        }
      }
      
      explode() {
        this.exploded = true;
        
        let shape = PARAMS.shape;
        if (shape === 'RANDOM') {
          const shapes = ['SPHERE', 'RING', 'STAR', 'HEART'];
          shape = shapes[Math.floor(Math.random() * shapes.length)];
        }
        
        const count = PARAMS.particleCount;
        
        for (let i = 0; i < count; i++) {
          let vx, vy;
          const angle = Math.random() * Math.PI * 2;
          const speed = Math.random() * 6 + 2;
          
          if (shape === 'SPHERE') {
            vx = Math.cos(angle) * speed;
            vy = Math.sin(angle) * speed;
          } else if (shape === 'RING') {
            const ringAngle = Math.random() * Math.PI * 2;
            vx = Math.cos(ringAngle) * (speed * 0.6);
            vy = Math.sin(ringAngle) * (speed * 0.6);
          } else if (shape === 'STAR') {
            const starAngle = (Math.floor(Math.random() * 5) * Math.PI * 2 / 5);
            vx = Math.cos(starAngle) * speed;
            vy = Math.sin(starAngle) * speed;
          } else if (shape === 'HEART') {
            const t = Math.random() * Math.PI * 2;
            vx = speed * Math.sin(t) * Math.cos(t);
            vy = speed * Math.sin(t) - 1;
          } else if (shape === 'TEXT') {
            vx = (Math.random() - 0.5) * 8;
            vy = -Math.random() * 8 - 2;
          } else {
            vx = (Math.random() - 0.5) * 10;
            vy = (Math.random() - 0.5) * 10;
          }
          
          let color;
          if (PARAMS.hue === -1) {
            const h = Math.random() * 360;
            color = `hsl(${h}, 100%, 60%)`;
          } else {
            const h = PARAMS.hue + (Math.random() - 0.5) * PARAMS.variance;
            color = `hsl(${h}, 100%, 60%)`;
          }
          
          particles.push(new Particle(this.x, this.y, vx, vy, color));
        }
        
        // æ–‡å­—çƒŸèŠ±ç‰¹æ®Šå¤„ç†
        if (shape === 'TEXT') {
          const lines = PARAMS.textRaw.split('\n').filter(t => t.trim());
          const text = lines[Math.floor(Math.random() * lines.length)] || 'ğŸ†';
          drawTextParticles(text);
        }
      }
      
      draw(ctx) {
        // ç»˜åˆ¶è½¨è¿¹
        this.trail.forEach(t => {
          ctx.fillStyle = `rgba(255, 100, 50, ${t.alpha * 0.5})`;
          ctx.beginPath();
          ctx.arc(t.x, t.y, 3 * t.alpha, 0, Math.PI * 2);
          ctx.fill();
        });
        
        // ç»˜åˆ¶ç«ç®­
        if (!this.exploded) {
          ctx.fillStyle = '#ff6432';
          ctx.shadowColor = '#ff6432';
          ctx.shadowBlur = 15;
          ctx.beginPath();
          ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
          ctx.fill();
          ctx.shadowBlur = 0;
        }
      }
      
      isDead() {
        return this.exploded;
      }
    }
    
    // æ–‡å­—ç²’å­
    let textParticles = [];
    
    function drawTextParticles(text) {
      textCtx.clearRect(0, 0, width, height);
      textCtx.font = `${80 * PARAMS.sizeScale}px "Microsoft YaHei", Arial`;
      textCtx.textAlign = 'center';
      textCtx.textBaseline = 'middle';
      
      const metrics = textCtx.measureText(text);
      const textWidth = metrics.width;
      const textHeight = 80 * PARAMS.sizeScale;
      
      // åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶æ–‡å­—
      textCtx.fillStyle = '#fff';
      textCtx.fillText(text, width / 2, height / 2);
      
      // è·å–æ–‡å­—åƒç´ 
      const imageData = textCtx.getImageData(0, 0, width, height);
      const data = imageData.data;
      
      // é‡‡æ ·åˆ›å»ºç²’å­
      const step = 3;
      for (let y = 0; y < height; y += step) {
        for (let x = 0; x < width; x += step) {
          const i = (y * width + x) * 4;
          if (data[i + 3] > 128) {
            let color;
            if (PARAMS.hue === -1) {
              const h = Math.random() * 360;
              color = `hsl(${h}, 100%, 60%)`;
            } else {
              color = `hsl(${PARAMS.hue}, 100%, 60%)`;
            }
            particles.push(new Particle(
              x,
              y,
              (Math.random() - 0.5) * 2,
              (Math.random() - 0.5) * 2 - 2,
              color
            ));
          }
        }
      }
      
      textCtx.clearRect(0, 0, width, height);
    }
    
    function createRocket(x, y) {
      rockets.push(new Rocket(x, y));
    }
    
    function createClickExplosion(x, y) {
      let shape = PARAMS.shape;
      if (shape === 'RANDOM') {
        const shapes = ['SPHERE', 'RING', 'STAR', 'HEART'];
        shape = shapes[Math.floor(Math.random() * shapes.length)];
      }
      
      const count = PARAMS.particleCount;
      
      for (let i = 0; i < count; i++) {
        let vx, vy;
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 6 + 2;
        
        if (shape === 'SPHERE') {
          vx = Math.cos(angle) * speed;
          vy = Math.sin(angle) * speed;
        } else if (shape === 'RING') {
          const ringAngle = Math.random() * Math.PI * 2;
          vx = Math.cos(ringAngle) * speed;
          vy = Math.sin(ringAngle) * speed;
        } else if (shape === 'STAR') {
          const starAngle = (Math.floor(Math.random() * 5) * Math.PI * 2 / 5);
          vx = Math.cos(starAngle) * speed;
          vy = Math.sin(starAngle) * speed;
        } else if (shape === 'HEART') {
          const t = Math.random() * Math.PI * 2;
          vx = speed * Math.sin(t) * Math.cos(t);
          vy = speed * Math.sin(t) - 1;
        } else if (shape === 'TEXT') {
          vx = (Math.random() - 0.5) * 6;
          vy = -Math.random() * 8 - 2;
        } else {
          vx = (Math.random() - 0.5) * 10;
          vy = (Math.random() - 0.5) * 10;
        }
        
        let color;
        if (PARAMS.hue === -1) {
          const h = Math.random() * 360;
          color = `hsl(${h}, 100%, 60%)`;
        } else {
          const h = PARAMS.hue + (Math.random() - 0.5) * PARAMS.variance;
          color = `hsl(${h}, 100%, 60%)`;
        }
        
        particles.push(new Particle(x, y, vx, vy, color));
      }
      
      // æ–‡å­—çƒŸèŠ±
      if (shape === 'TEXT') {
        const lines = PARAMS.textRaw.split('\n').filter(t => t.trim());
        const text = lines[Math.floor(Math.random() * lines.length)] || 'ğŸ†';
        drawTextParticles(text);
      }
    }
    
    // --- 4. æ¸²æŸ“å¾ªç¯ ---
    function animate() {
      if (!isRunning) return;
      
      // æ‹–å°¾æ•ˆæœ
      ctx.fillStyle = `rgba(5, 5, 5, ${1 - PARAMS.trail})`;
      ctx.fillRect(0, 0, width, height);
      
      // æ›´æ–°ç«ç®­
      rockets = rockets.filter(r => {
        r.update();
        r.draw(ctx);
        return !r.isDead();
      });
      
      // æ›´æ–°ç²’å­
      particles = particles.filter(p => {
        p.update();
        p.draw(ctx);
        return !p.isDead();
      });
      
      requestAnimationFrame(animate);
    }
    
    // --- 5. æ‰‹åŠ¿è¯†åˆ« ---
    function onResults(results) {
      if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        document.querySelector('.gesture-hint').classList.add('visible');
        
        const landmarks = results.multiHandLandmarks[0];
        const thumbTip = landmarks[4];
        const indexTip = landmarks[8];
        const distance = Math.hypot(
          (indexTip.x - thumbTip.x) * width,
          (indexTip.y - thumbTip.y) * height
        );
        
        const now = Date.now();
        if (distance < 50 && now - lastPinchTime > 500) {
          lastPinchTime = now;
          for (let i = 0; i < 3; i++) {
            setTimeout(() => {
              createRocket(
                Math.random() * width * 0.6 + width * 0.2,
                height * 0.3 + Math.random() * height * 0.2
              );
            }, i * 100);
          }
        }
      } else {
        document.querySelector('.gesture-hint').classList.remove('visible');
      }
    }
    
    async function initCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment' }
        });
        video.srcObject = stream;
        video.play();
        
        hands = new Hands({
          locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/${file}`
        });
        
        hands.setOptions({
          maxNumHands: 1,
          modelComplexity: 1,
          minDetectionConfidence: 0.7,
          minTrackingConfidence: 0.5
        });
        
        hands.onResults(onResults);
        
        camera = new Camera(video, {
          onFrame: async () => {
            if (hands && isRunning) {
              await hands.send({image: video});
            }
          },
          width: 640,
          height: 480
        });
        
        camera.start();
      } catch (err) {
        console.log('Camera not available:', err);
        document.getElementById('loading-text').textContent = 'æ‘„åƒå¤´ä¸å¯ç”¨ï¼Œä½†ä½ å¯ä»¥ç‚¹å‡»å±å¹•å‘å°„çƒŸèŠ±';
      }
    }
    
    // --- 6. UI é€»è¾‘ ---
    function initUI() {
      // å½¢çŠ¶åˆ‡æ¢
      const btns = document.querySelectorAll('.shape-btn');
      const textContainer = document.getElementById('text-input-container');
      btns.forEach(btn => {
        btn.addEventListener('click', () => {
          btns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          PARAMS.shape = btn.dataset.shape;
          textContainer.style.display = PARAMS.shape === 'TEXT' ? 'block' : 'none';
        });
      });
      
      // æ–‡æœ¬åŸŸç›‘å¬
      const textarea = document.getElementById('firework-text');
      PARAMS.textRaw = textarea.value;
      textarea.addEventListener('input', (e) => {
        PARAMS.textRaw = e.target.value;
      });
      
      // ç»‘å®šæ»‘å—
      function bindSlider(id, key, dispId) {
        const el = document.getElementById(id);
        const disp = document.getElementById(dispId);
        el.addEventListener('input', (e) => {
          let val = parseFloat(e.target.value);
          PARAMS[key] = val;
          if (key === 'hue' && val === -1) disp.innerText = "å½©è‰²/éšæœº";
          else if (key === 'gravity') disp.innerText = (val / 100).toFixed(2);
          else if (key === 'trail') disp.innerText = (val / 100).toFixed(2);
          else disp.innerText = val;
        });
      }
      
      bindSlider('p-particles', 'particleCount', 'val-particles');
      bindSlider('p-size', 'sizeScale', 'val-size');
      bindSlider('p-gravity', 'gravity', 'val-gravity');
      bindSlider('p-trail', 'trail', 'val-trail');
      bindSlider('hue-slider', 'hue', 'val-hue');
      bindSlider('p-brightness', 'brightness', 'val-brightness');
      
      // é¢æ¿å¼€å…³
      let visible = true;
      const p = document.getElementById('control-panel');
      const b = document.getElementById('toggle-panel');
      b.addEventListener('click', () => {
        visible = !visible;
        p.style.transform = visible ? 'translateX(0)' : 'translateX(320px)';
        b.style.right = visible ? '320px' : '10px';
        b.classList.toggle('right', !visible);
      });
    }
    
    // --- 7. å¯åŠ¨ ---
    document.getElementById('start-btn').addEventListener('click', async () => {
      document.getElementById('overlay').classList.add('hidden');
      isRunning = true;
      initUI();
      await initCamera();
      animate();
      
      // è‡ªåŠ¨å‘å°„
      setInterval(() => {
        if (isRunning && Math.random() < 0.2) {
          createRocket(
            Math.random() * width * 0.7 + width * 0.15,
            height * 0.2 + Math.random() * height * 0.3
          );
        }
      }, 600);
    });
    
    // ç‚¹å‡»äº‹ä»¶
    canvas.addEventListener('click', (e) => {
      if (isRunning) {
        createClickExplosion(e.clientX, e.clientY);
      }
    });
    
    canvas.addEventListener('touchstart', (e) => {
      if (isRunning) {
        for (let i = 0; i < e.touches.length; i++) {
          createClickExplosion(e.touches[i].clientX, e.touches[i].clientY);
        }
      }
    });
  </script>
</body>
</html>
